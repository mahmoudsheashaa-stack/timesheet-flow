{% extends "core/base.html" %}
{% block title %}Timesheet {{ timesheet.month }}/{{ timesheet.year }} - Timesheet Flow{% endblock %}
{% block content %}
<div class="card">
  <div class="card-header">
    <div>
      <div class="page-title">Timesheet {{ timesheet.month }}/{{ timesheet.year }}</div>
      <div class="small">Hourly rate: <strong>{{ hourly_rate }} QAR</strong></div>
    </div>
    <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
      <a href="{% url 'timesheet_export_csv' timesheet.pk %}">
        <button class="btn btn-outline" type="button">⬇️ Export CSV</button>
      </a>
      <a href="{% url 'timesheet_list' %}">
        <button class="btn btn-outline" type="button">Back to list</button>
      </a>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Hours</th>
        <th>Daily amount</th>
        <th>Intensity</th>
        <th>Note</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for e in entries %}
      <tr class="{% if e.hours_worked >= 8 %}row-strong{% elif e.hours_worked >= 4 %}row-mid{% else %}row-low{% endif %}">
        <td>{{ e.date }}</td>
        <td>{{ e.hours_worked|floatformat:2 }}</td>
        <td>{{ e.daily_amount|floatformat:2 }} QAR</td>
        <td>
          {% if e.hours_worked >= 8 %}
            <span class="badge badge-green">Full day</span>
          {% elif e.hours_worked >= 4 %}
            <span class="badge badge-orange">Half day</span>
          {% else %}
            <span class="badge badge-slate">Light</span>
          {% endif %}
        </td>
        <td>{{ e.note }}</td>
        <td>
          <form method="post" style="margin:0;">
            {% csrf_token %}
            <input type="hidden" name="entry_id" value="{{ e.id }}">
            <button class="btn btn-outline" type="submit" name="delete_entry">✕</button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="small">No entries yet. Add your first day below.</td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th>Total</th>
        <th>{{ total_hours|floatformat:2 }} h</th>
        <th>{{ total_amount|floatformat:2 }} QAR</th>
        <th colspan="3"></th>
      </tr>
    </tfoot>
  </table>
</div>

<div class="card">
  <div class="card-header">
    <div class="card-title">Add / update a day</div>
    <span class="pill">New entry</span>
  </div>
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="add_entry" value="1">
    <div class="form-row">
      <div>
        <label class="small">Date</label>
        {{ entry_form.date }}
      </div>
      <div>
        <label class="small">Hours worked</label>
        {{ entry_form.hours_worked }}
      </div>
    </div>
    <div style="margin-top:.5rem;">
      <label class="small">Note</label>
      {{ entry_form.note }}
    </div>
    <button class="btn btn-primary" type="submit" style="margin-top:.8rem;">Save day</button>
  </form>
  <p class="small" style="margin-top:.5rem;">
    You can add multiple entries for the same date if you want to track separate blocks of work.
  </p>
</div>
{% endblock %}
